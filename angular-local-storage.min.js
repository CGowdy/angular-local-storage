(function(){"use strict";var e=angular.module("LocalStorageModule",[]);e.provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:true,removeItem:false};this.setPrefix=function(e){this.prefix=e};this.setStorageType=function(e){this.storageType=e};this.setStorageCookie=function(e,t){this.cookie={expiry:e,path:t}};this.setStorageCookieDomain=function(e){this.cookie.domain=e};this.setNotify=function(e,t){this.notify={setItem:e,removeItem:t}};this.$get=["$rootScope","$window","$document",function(e,t,n){var r=this.prefix;var i=this.cookie;var s=this.notify;var o=this.storageType;var u;if(!n){n=document}if(r.substr(-1)!=="."){r=!!r?r+".":""}var a=function(e){return r+e};var f=function(){try{var n=o in t&&t[o]!==null;var r=a("__"+Math.round(Math.random()*1e7));if(n){u=t[o];u.setItem(r,"");u.removeItem(r)}return n}catch(i){o="cookie";e.$broadcast("LocalStorageModule.notification.error",i.message);return false}}();var l=function(t,n){if(!f){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");if(s.setItem){e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:n,storageType:"cookie"})}return m(t,n)}if(typeof n==="undefined"){n=null}try{if(angular.isObject(n)||angular.isArray(n)){n=angular.toJson(n)}if(u){u.setItem(a(t),n)}if(s.setItem){e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:n,storageType:o})}}catch(r){e.$broadcast("LocalStorageModule.notification.error",r.message);return m(t,n)}return true};var c=function(t){if(!f){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return g(t)}var n=u?u.getItem(a(t)):null;if(!n||n==="null"){return null}if(n.charAt(0)==="{"||n.charAt(0)==="["){return angular.fromJson(n)}return n};var h=function(t){if(!f){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");if(s.removeItem){e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"})}return b(t)}try{u.removeItem(a(t));if(s.removeItem){e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:o})}}catch(n){e.$broadcast("LocalStorageModule.notification.error",n.message);return b(t)}return true};var p=function(){if(!f){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return y()}var t=r.length;var n=[];for(var i in u){if(i.substr(0,t)===r){try{n.push(i.substr(t))}catch(s){e.$broadcast("LocalStorageModule.notification.error",s.Description);return[]}}}return n};var d=function(t){t=t||"";var n=r.slice(0,-1);var i=new RegExp(n+"."+t);if(!f){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return w()}var s=r.length;for(var o in u){if(i.test(o)){try{h(o.substr(s))}catch(a){e.$broadcast("LocalStorageModule.notification.error",a.message)}}}return true};var v=function(){try{return navigator.cookieEnabled||"cookie"in n&&(n.cookie.length>0||(n.cookie="test").indexOf.call(n.cookie,"test")>-1)}catch(t){e.$broadcast("LocalStorageModule.notification.error",t.message);return false}};var m=function(t,r){if(typeof r==="undefined"){return false}if(!v()){e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}try{var s=n.cookie?n.cookie.split(";"):[];var o="",u=new Date,f="";if(r===null){var l;for(var c=0;c<s.length;c++){if(s[c].indexOf(a(t))>-1){l=c;break}}s.splice(l,1);n.cookie=s.join(";");if(s===[]||s[0].indexOf("expires")>-1){u.setTime(u.getTime()+ -1*24*60*60*1e3);o="; expires="+u.toGMTString();r=""}return true}else if(i.expiry!==0){u.setTime(u.getTime()+i.expiry*24*60*60*1e3);o="; expires="+u.toGMTString()}if(!!t){var h="; path="+i.path;if(i.domain){f="; domain="+i.domain}var p=n.cookie?n.cookie.substr(0,n.cookie.indexOf("; expires")):"";if(p){n.cookie=p+";"+a(t)+"="+encodeURIComponent(r)+o+h+f}else{n.cookie=a(t)+"="+encodeURIComponent(r)+o+h+f}}}catch(d){e.$broadcast("LocalStorageModule.notification.error",d.message);return false}return true};var g=function(t){if(!v()){e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}var i=n.cookie&&n.cookie.split(";")||[];for(var s=0;s<i.length;s++){var o=i[s];while(o.charAt(0)===" "){o=o.substring(1,o.length)}if(o.indexOf(a(t)+"=")===0){return decodeURIComponent(o.substring(r.length+t.length+1,o.length))}}return null};var y=function(){var t=[];var i=null,s=null;var o=r.length;var u=typeof n.cookie!="undefined"?n.cookie.split(";"):[];for(var a=0;a<u.length;a++){i=u[a].trim();if(i.substr(0,o)===r){try{t.push(i.substr(o,i.indexOf("=")-o))}catch(f){e.$broadcast("LocalStorageModule.notification.error",f.Description);return[]}}}return t};var b=function(e){m(e,null)};var w=function(){var e=null,t=null;var i=r.length;var s=n.cookie?n.cookie.split(";"):[];for(var o=0;o<s.length;o++){e=s[o];while(e.charAt(0)===" "){e=e.substring(1,e.length)}var u=e.substring(i,e.indexOf("="));b(u)}};var E=function(){return o};var S=function(e,t,n){var r=c(t);if(r===null&&angular.isDefined(n)){r=n}else if(angular.isObject(r)&&angular.isObject(n)){r=angular.extend(n,r)}e[t]=r;e.$watchCollection(t,function(e){l(t,e)})};return{isSupported:f,getStorageType:E,set:l,add:l,get:c,keys:p,remove:h,clearAll:d,bind:S,deriveKey:a,cookie:{set:m,add:m,get:g,remove:b,clearAll:w}}}]})}).call(this)